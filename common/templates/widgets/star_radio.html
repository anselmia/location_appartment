{% load static %}
{% load i18n %}
<link rel="stylesheet" href="{% static 'common/css/star_radio.css' %}">

<div class="star-rating" data-stars>
  {% for group, options, index in widget.optgroups %}
    {% for option in options %}
      {% if option.value %}
        <input type="radio" name="{{ widget.name }}" value="{{ option.value }}" id="{{ widget.attrs.id }}_{{ option.value }}"
               {% if option.selected %}checked{% endif %}
               {% include "django/forms/widgets/attrs.html" %}>
        <label for="{{ widget.attrs.id }}_{{ option.value }}" data-star="{{ option.value }}" title="{{ option.value }} Ã©toile{{ option.value|pluralize }}">
          <i class="bi bi-star-fill"></i>
        </label>
      {% endif %}
    {% endfor %}
  {% endfor %}
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  document.querySelectorAll('.star-rating').forEach(function(starRating) {
    const labels = Array.from(starRating.querySelectorAll('label'));
    const radios = Array.from(starRating.querySelectorAll('input[type="radio"]'));

    function fillStars(upto) {
      labels.forEach((label, idx) => {
        if (idx <= upto) {
          label.classList.add('filled');
        } else {
          label.classList.remove('filled');
        }
      });
    }

    // Initial fill based on checked radio
    const checked = radios.findIndex(radio => radio.checked);
    if (checked >= 0) fillStars(checked);

    labels.forEach((label, idx) => {
      label.addEventListener('mouseenter', function() {
        fillStars(idx);
      });
      label.addEventListener('mouseleave', function() {
        // Restore to checked
        const checked = radios.findIndex(radio => radio.checked);
        fillStars(checked);
      });
      label.addEventListener('click', function() {
        fillStars(idx);
      });
    });
  });
});
</script>