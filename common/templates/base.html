{% load static %}
{% load i18n %}
{% get_current_language as LANGUAGE_CODE %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}" ontouchstart>
    <head>
        <meta charset="UTF-8">
        <title>
            {% block title %}{{ entreprise.name }} - Location Nice Côte d'Azur{% endblock %}
        </title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="canonical" href="{{ request.build_absolute_uri }}">
        <link rel="shortcut icon" href="{% static 'logement/img/favicon.ico' %}">
        <!-- SEO & Open Graph -->
        <meta name="description"
              content="{% block meta_description %}{% endblock %}">
        <meta name="keywords"
              content="location Nice et côte d'Azur, location vacances Nice et côte d'Azur, chambre à louer Nice et côte d'Azur, location courte durée Nice et côte d'Azur, appartement meublé Nice et côte d'Azur, hébergement Nice et côte d'Azur, bead and breakfast Nice et côte d'Azur">
        <meta name="robots" content="index, follow">
        <meta property="og:title"
              content="Location d'appartements sur Nice et la côte d'Azur" />
        <meta property="og:description"
              content="Réservez facilement un logement de vacance ou de courte durée. Réservation rapide et fiable." />
        <meta property="og:url"
              content="{{ site_address|default:request.build_absolute_uri }}">
        <meta property="og:type" content="website" />
        <meta name="google-site-verification"
              content="Ezmpcz3zkqC2psThMGeZ1zDx5syx8C7Qsi7b7ftz4h0" />
        <!-- Preload critical banner image -->
        <link rel="preload"
              as="image"
              href="{% if config.banner_image_webp %}{{ config.banner_image_webp.url }}{% else %}{% static 'logement/img/banner.webp' %}{% endif %}"
              type="image/webp"
              fetchpriority="high">
        <!-- Fonts (minimize blocking) -->
        <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&display=swap"
              rel="stylesheet">
        <!-- Critical Stylesheets -->
        <link rel="stylesheet" href="{% static 'common/css/styles.css' %}">
        <!-- Deferred Stylesheets -->
        <link rel="stylesheet"
              href="{% static 'common/css/footer.css' %}"
              media="print"
              onload="this.media='all'">
        <link rel="stylesheet"
              href="{% static 'common/css/nav.css' %}"
              media="print"
              onload="this.media='all'">
        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
              media="print"
              onload="this.media='all'">
        <link rel="stylesheet"
              href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
              media="print"
              onload="this.media='all'">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
              rel="stylesheet"
              media="print"
              onload="this.media='all'"
              integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
              crossorigin="anonymous">
        <!-- Sitemap -->
        <link rel="sitemap" type="application/xml" href="/sitemap.xml">
        <!-- JSON-LD -->
        <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "LodgingBusiness",
        "name": "BnB Azur",
        "description": "Location courte durée sur la Côte d'Azur : appartements meublés, chambres à louer pour vacances, séjour étudiant ou professionnel. Plateforme fiable avec réservation rapide et services de conciergerie haut de gamme.",
        "url": "https://www.bnbAzur.fr",
        "priceRange": "€€",
        "address": {
            "@type": "PostalAddress",
            "addressLocality": "Nice",
            "addressCountry": "FR"
        },
        "geo": {
            "@type": "GeoCoordinates",
            "latitude": 43.7000,
            "longitude": 7.2700
        }
    }
        </script>
        {% block extrahead %}{% endblock %}
    </head>
    <body class="page-wrapper">
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show mt-3"
                     role="alert">{{ message }}</div>
            {% endfor %}
        {% endif %}
        <div id="loader" style="text-align: center;">
            <span class="spinner-border text-primary" role="status" aria-hidden="true"></span>
            <div class="mt-2">Chargement...</div>
        </div>
        {% include "navbar.html" %}
        <main class="main-content">
            {% block content %}{% endblock %}
        </main>
        <a href="{% url 'accounts:contact' %}" class="whatsapp-float">
            <i class="fab fa-whatsapp"></i>
        </a>
        <!-- Chatbot Launcher -->
        <div id="chatbot-launcher" onclick="toggleChat()">
            <img src="{% static 'common/img/chatbot.jpg' %}"
                 alt="Chatbot"
                 class="chatbot-icon" />
        </div>
        <div id="chatbot-window" style="display: none;">
            <div id="chatbot-header">
                <strong>Assistant IA</strong>
                <button id="chatbot-close" onclick="toggleChat()">×</button>
            </div>
            <div id="chat-log"></div>
            <div id="chatbot-input">
                <input type="text" id="user-message" placeholder="Posez une question..." />
                <button onclick="sendMessage()">Envoyer</button>
            </div>
        </div>
        <div class="footer-wave">
            <svg viewBox="0 0 1440 100">
                <path fill="#f8f5f2" d="M0,32L1440,96L1440,0L0,0Z"></path>
            </svg>
        </div>
        <div id="cookie-banner"
             style="display: none"
             class="cookie-banner shadow rounded p-3"
             role="dialog"
             aria-modal="true"
             aria-labelledby="cookie-title">
            <div class="d-flex align-items-center mb-2">
                <!-- SVG Cookie Icon -->
                <svg width="38" height="38" viewBox="0 0 38 38" fill="none" class="me-2">
                    <circle cx="19" cy="19" r="19" fill="#bfa66b" />
                    <circle cx="13" cy="15" r="2" fill="#fff" />
                    <circle cx="25" cy="13" r="1.5" fill="#fff" />
                    <circle cx="19" cy="25" r="2" fill="#fff" />
                    <circle cx="25" cy="22" r="1.2" fill="#fff" />
                </svg>
                <div>
                    <span class="fw-bold fs-5" id="cookie-title">Gestion des cookies</span>
                </div>
            </div>
            <p class="mb-3">
                Nous utilisons des cookies pour améliorer votre expérience, mesurer l’audience et proposer des services tiers (Google Maps, Google Analytics, traduction, etc.).
                <a href="{% url 'common:cgu' %}" target="_blank" rel="noopener">En savoir plus</a>
            </p>
            <div class="cookie-actions d-flex flex-wrap gap-2 mb-3">
                <button id="accept-cookies"
                        class="btn btn-success btn-sm flex-fill shadow-sm">Tout accepter</button>
                <button id="refuse-cookies"
                        class="btn btn-outline-secondary btn-sm flex-fill shadow-sm">Tout refuser</button>
                <button id="customize-cookies" class="btn btn-link btn-sm flex-fill">Personnaliser</button>
            </div>
            <div id="cookie-customize-panel" style="display:none; margin-top:1rem;">
                <form>
                    <div class="mb-3">
                        <label class="form-check-label d-flex align-items-center">
                            <input type="checkbox" checked disabled class="form-check-input me-2">
                            <strong>Cookies nécessaires</strong>
                            <span class="ms-1 badge bg-secondary">Toujours actifs</span>
                        </label>
                        <div class="text-muted small ms-4">Indispensables au fonctionnement du site (connexion, sécurité, réservation...)</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-check-label d-flex align-items-center">
                            <input type="checkbox"
                                   id="consent-analytics"
                                   checked
                                   class="form-check-input me-2">
                            Statistiques <span class="ms-1 text-muted">(Google Analytics)</span>
                        </label>
                    </div>
                    <div class="mb-3">
                        <label class="form-check-label d-flex align-items-center">
                            <input type="checkbox"
                                   id="consent-maps"
                                   checked
                                   class="form-check-input me-2">
                            Services tiers <span class="ms-1 text-muted">(Google Maps, traduction...)</span>
                        </label>
                    </div>
                    <button type="button"
                            id="save-cookie-preferences"
                            class="btn btn-primary btn-sm mt-2 w-100 shadow-sm">Enregistrer mes choix</button>
                </form>
            </div>
            <div class="text-center mt-2">
                <small class="text-muted">Vous pouvez modifier vos préférences à tout moment en cliquant sur « Gérer mes cookies » en bas de page.</small>
            </div>
        </div>
        {% include "footer.html" %}
        {% block extra_js %}{% endblock %}
        <!-- Cookie Banner -->
        {% include 'common/includes/cookie_banner.html' %}
        <!-- Deferred Scripts -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js" defer></script>
        <script src="https://cdn.jsdelivr.net/npm/flatpickr" defer></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
                defer></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js" defer></script>
        <script src="https://unpkg.com/@popperjs/core@2" defer></script>
        <script src="https://unpkg.com/tippy.js@6" defer></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" defer></script>
        <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"
                defer></script>
        <script src="https://unpkg.com/htmx.org@1.9.2" defer></script>
        <script src="{% static 'common/js/nav.js' %}" defer></script>
        <script src="{% static 'common/js/global.js' %}" defer></script>
        <script> chat_url = "{% url 'common:chatbot_api' %}"; </script>
    </body>
</html>
