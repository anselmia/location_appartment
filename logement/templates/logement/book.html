{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block content %}
    <div class="container">
        <!-- Image Gallery / Carousel -->
        <div class="row justify-content-center mt-4">
            <div class="col-md-10">
                <div class="card shadow-lg rounded-lg" id="image-gallery">
                    <div class="card-body">
                        <h4 class="text-center mb-4">Galerie d'images</h4>
                        <div class="carousel-wrapper-book">
                            {% if photos %}
                                <div class="carousel-large-image">
                                        <img src="{{ photos.0.image.url }}" alt="Large Image">
                                </div>
                                
                                <!-- Small images on the right -->
                                <div class="carousel-small-images">
                                    {% if photos|length > 1 %}
                                        <div class="carousel-item-img smaller-photo">
                                            <img src="{{ photos.1.image.url }}" class="d-block w-100 h-100" alt="Image 2">
                                        </div>
                                    {% endif %}
                                    {% if photos|length > 2 %}
                                        <div class="carousel-item-img smaller-photo">
                                            <img src="{{ photos.2.image.url }}" class="d-block w-100 h-100" alt="Image 3">
                                        </div>
                                    {% endif %}
                                    {% if photos|length > 3 %}
                                        <div class="carousel-item-img smaller-photo">
                                            <img src="{{ photos.3.image.url }}" class="d-block w-100 h-100" alt="Image 4">
                                        </div>
                                    {% endif %}
                                    {% if photos|length > 4 %}
                                        <div class="carousel-item-img smaller-photo">
                                            <img src="{{ photos.4.image.url }}" class="d-block w-100 h-100" alt="Image 5">
                                        </div>
                                    {% endif %}
                                </div>
                                
                            {% else %}
                                <p style="text-align: center;">{% trans "Aucune photo disponible pour ce logement." %}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row justify-content-center mt-5">
            <!-- Left Side: Reservation Form -->
            <div class="col-md-5">
                <div class="card shadow-lg rounded-lg" id="reservation-form-card">
                    <div class="card-body">
                        <h2 class="text-center mb-4">{{ logement.name }}</h2>
    
                        <form method="post" id="reservation-form">
                            {% csrf_token %}
                            
                            <!-- Display errors if the form is invalid -->
                            {% if form.errors %}
                                <div class="alert alert-danger">
                                    <ul>
                                        {% for field in form %}
                                            {% for error in field.errors %}
                                                <li>{{ error }}</li>
                                            {% endfor %}
                                        {% endfor %}
                                        {% for error in form.non_field_errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            {% endif %}
                            
                            <h3 class="text-center mb-4">Informations sur le séjour</h3>

                            <div class="form-group">
                                <label for="id_guest">Voyageurs</label>
                                {{ form.guest }}
                            </div>
    
                            <div class="form-group">
                                <label for="id_start">Date de début</label>
                                {{ form.start }}
                            </div>
    
                            <div class="form-group">
                                <label for="id_end">Date de fin</label>
                                {{ form.end }}
                            </div>

                            <h3 class="text-center mb-4">Informations sur le voyageur</h3>
                            <!-- Input Fields -->
                            <div class="form-group">
                                <label for="id_last_name">Nom</label>
                                {{ form.last_name }}
                            </div>
    
                            <div class="form-group">
                                <label for="id_name">Prénom</label>
                                {{ form.name }}
                            </div>
    
                            <div class="form-group">
                                <label for="id_email">Email</label>
                                {{ form.email }}
                            </div>
    
                            <div class="form-group">
                                <label for="id_phone">Téléphone</label>
                                {{ form.phone }}
                            </div>  
    
                            <!-- Submit Button -->
                            <div class="form-group text-center">
                                <button type="submit" class="btn btn-primary btn-lg">Envoyer la demande</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
    
            <!-- Right Side: Reservation Summary -->
            <div class="col-md-5">
                <div class="card shadow-lg rounded-lg" id="reservation-summary-card">
                    <div class="card-body">
                        <h4 class="text-center mb-4">Résumé de la Réservation</h4>
    
                        <div>
                            <p><strong>Prix par nuit :</strong> <span id="price-per-night">0 €</span></p>
                            <p><strong>Arrivée :</strong> {{ form.start.value }}</p>
                            <p><strong>Départ :</strong> {{ form.end.value }}</p>
                            <p><strong>Voyageurs :</strong> {{ form.guest.value }}</p>
    
                            <hr>
    
                            <p><strong>Total nuits :</strong> <span id="total-nights">0</span> nuits</p>
                            <p><strong>Frais de ménage :</strong> <span id="cleaning-fee">0 €</span></p>
                            <p><strong>Taxes :</strong> <span id="tourist-tax">0 €</span></p>
    
                            <hr>
    
                            <h4><strong>Total :</strong> <span id="total-price">0 €</span></h4>
                            <p>Aucun montant ne vous sera débité pour le moment</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script>
    const logement_js = {{ logement|safe }};
</script>

<script src="{% static 'logement/js/booking.js' %}"></script>
{% endblock %}
