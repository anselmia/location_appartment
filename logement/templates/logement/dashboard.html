{% extends "base.html" %}
{% load static %}
{% load i18n %}
{% load widget_tweaks %}
{% block title %}Tableau de bord des logements | {{ entreprise.name }}{% endblock %}
{% block meta_description %}
  Gérez vos logements sur {{ entreprise.name }} : ajoutez, modifiez et consultez vos annonces de logements disponibles.
{% endblock %}
{% block extrahead %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'logement/css/dashboard.css' %}">
{% endblock %}
{% block content %}
  <div class="admin-logement-container">
    <div class="admin-header">
      <div class="admin-header-title">
        <h1>Gestion des logements</h1>
        <p class="admin-subtitle">Gérez vos annonces, ajoutez ou modifiez les logements disponibles</p>
      </div>
      {% if user.is_owner or user.is_admin or user.is_superuser %}
        <a href="{% url 'logement:add_logement' %}" class="btn-add-logement">➕ Nouveau logement</a>
      {% endif %}
    </div>
    {% if logements %}
      <div class="logement-grid">
        {% for logement in logements %}
          <div class="logement-card">
            <a href="{% url 'logement:edit_logement' logement.id %}"
               class="logement-card-link">
              {% if logement.photos.first %}
                <img src="{{ logement.photos.first.image.url }}"
                     alt="{{ logement.name }}"
                     class="logement-thumb">
              {% else %}
                <div class="logement-thumb placeholder">📷</div>
              {% endif %}
              <div class="logement-card-body">
                <h3 class="logement-title">{{ logement.name }}</h3>
                <p class="logement-city">
                  {% if logement.ville %}
                    {{ logement.ville.name }}
                  {% else %}
                    —
                  {% endif %}
                </p>
                <div class="logement-details">
                  <span>💰 {{ logement.price }} €</span>
                  <span>📐 {{ logement.superficie|default:"—" }} m²</span>
                  <span>🛏 {{ logement.bedrooms }} chambres</span>
                  <span>🚿 {{ logement.bathrooms }} sdb</span>
                  <span>👤 {{ logement.nominal_traveler }} pers.</span>
                </div>
                <div class="logement-tags">
                  <span class="tag type">{{ logement.get_type_display }}</span>
                  <span class="tag status {{ logement.statut }}">{{ logement.get_statut_display }}</span>
                </div>
              </div>
            </a>
          </div>
        {% endfor %}
      </div>
      <div class="d-flex justify-content-center mt-4">
        <nav aria-label="Pagination">
          <ul class="pagination-list">
            {% if page_obj.has_previous %}
              <li class="page-item">
                <a href="?page={{ page_obj.previous_page_number }}"
                   aria-label="Précédent">
                  <span aria-hidden="true">&laquo;</span>
                </a>
              </li>
            {% else %}
              <li class="page-item disabled">
                <span>&laquo;</span>
              </li>
            {% endif %}
            {% for num in page_obj.paginator.page_range %}
              <li class="page-item {% if page_obj.number == num %}active{% endif %}">
                <a href="?page={{ num }}">{{ num }}</a>
              </li>
            {% endfor %}
            {% if page_obj.has_next %}
              <li class="page-item">
                <a href="?page={{ page_obj.next_page_number }}" aria-label="Suivant">
                  <span aria-hidden="true">&raquo;</span>
                </a>
              </li>
            {% else %}
              <li class="page-item disabled">
                <span>&raquo;</span>
              </li>
            {% endif %}
          </ul>
        </nav>
      </div>
    {% else %}
      <div class="no-logement">Aucun logement pour le moment.</div>
    {% endif %}
  </div>
{% endblock %}
