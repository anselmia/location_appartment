{% extends "base.html" %}
{% load static %}
{% block extrahead %}
    {{ block.super }}
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet"
          href="{% static 'activity/css/activity_calendar.css' %}" />
{% endblock extrahead %}
{% block content %}
    <div class="container py-4">
        <div id="error-alert" class="alert alert-danger d-none" role="alert"></div>
        <div class="d-flex flex-column flex-sm-row gap-2 justify-content-sm-between align-items-start align-items-sm-center mb-4">
            <h3 class="mb-3 fw-bold">📅 Calendrier des activités</h3>
            <select id="activity-selector" class="form-select w-100 w-sm-auto ml-3">
                {% for activity in activities %}
                    <option value="{{ activity.id }}" {% if forloop.first %}selected{% endif %}>{{ activity.name }}</option>
                {% endfor %}
            </select>
        </div>
        <p class="text-muted small mt-2">📱 Astuce : touchez deux dates pour sélectionner une plage.</p>
        <div class="d-flex gap-4">
            <div class="calendar-wrapper d-flex flex-wrap flex-md-nowrap position-relative">
                <div id="calendar"
                     class="flex-grow-1 border rounded shadow-sm p-2 bg-white"
                     data-activity-id="{{ activity.id }}"></div>
                <div id="price-panel"
                     class="price-panel hidden border rounded shadow-sm p-3 bg-light">
                    <h5 class="fw-bold mb-3">🛠 Modifier le prix</h5>
                    <p id="panel-dates" class="small text-muted"></p>
                    <div class="mb-3">
                        <label for="statut" class="form-label">Statut</label>
                        <select id="statut" class="form-select">
                            <option value="1">🟢 Ouvert</option>
                            <option value="0">🔴 Fermé</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="base-price" class="form-label">Prix de base (€)</label>
                        <input type="number" id="base-price" class="form-control" />
                    </div>
                    <div id="details" class="price-details-container mb-3">
                        <!-- Details inserted here -->
                    </div>
                    <div class="mb-3">
                        <strong>💰 Prix Total : <span id="final-price">0</span> €</strong>
                    </div>
                    <div class="d-grid gap-2">
                        <button id="apply-price" class="btn btn-success">✅ Appliquer</button>
                        <button id="cancel-price" class="btn btn-secondary">❌ Annuler</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}
{% block extra_js %}
  <script>const csrfToken = "{{ csrf_token }}";</script>
  {{ activity_json|json_script:"activities-data" }}
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js'></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <script src="{% static 'activity/js/activity_calendar.js' %}"></script>
{% endblock extra_js %}

