{% extends "base.html" %}
{% load static %}
{% load widget_tweaks %}
{% load extra_tags %}
{% block title %}Tableau de bord – {{ entreprise.name }}{% endblock %}
{% block meta_description %}
  Accédez à votre tableau de bord personnel sur {{ entreprise.name }} : gérez vos informations, réservations, comptes partenaires ou conciergerie, et suivez vos activités de location à Nice et sur la Côte d’Azur.
{% endblock %}
{% block extrahead %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'accounts/css/dashboard.css' %}">
{% endblock %}
{% block content %}
  <div class="container client-dashboard mt-5">
    <h1 class="mb-5 text-center fw-semibold display-5 text-dark">Tableau de bord</h1>
    <div class="row dashboard">
      <!-- Tabs on the left -->
      <div class="col-md-3 mb-4">
        <ul class="nav flex-column nav-pills" id="dashboardTabs" role="tablist">
          <li class="nav-item mb-2" role="presentation">
            <button class="nav-link active w-100"
                    id="profile-tab-link"
                    data-bs-toggle="pill"
                    data-bs-target="#profile-tab"
                    type="button"
                    role="tab"
                    aria-controls="profile-tab"
                    aria-selected="true">Informations personnelles</button>
          </li>
          <li class="nav-item mb-2" role="presentation">
            <button class="nav-link w-100"
                    id="password-tab-link"
                    data-bs-toggle="pill"
                    data-bs-target="#password-tab"
                    type="button"
                    role="tab"
                    aria-controls="password-tab"
                    aria-selected="false">Changer mon mot de passe</button>
          </li>
          {% if not user.is_owner and not user.is_owner_admin and not user.is_partner %}
            <li class="nav-item mb-2" role="presentation">
              <button class="nav-link w-100"
                      id="reservations-tab-link"
                      data-bs-toggle="pill"
                      data-bs-target="#reservations-tab"
                      type="button"
                      role="tab"
                      aria-controls="reservations-tab"
                      aria-selected="false">Mes Réservations</button>
            </li>
          {% endif %}
          {% if user.is_owner_admin or user.is_admin or user.is_superuser %}
            <li class="nav-item mb-2" role="presentation">
              <button class="nav-link w-100"
                      id="admin-tab-link"
                      data-bs-toggle="pill"
                      data-bs-target="#admin-tab"
                      type="button"
                      role="tab"
                      aria-controls="admin-tab"
                      aria-selected="false">Compte Conciergerie</button>
            </li>
          {% endif %}
          {% if user.is_partner or user.is_admin or user.is_superuser %}
            <li class="nav-item mb-2" role="presentation">
              <button class="nav-link w-100"
                      id="partner-tab-link"
                      data-bs-toggle="pill"
                      data-bs-target="#partner-tab"
                      type="button"
                      role="tab"
                      aria-controls="partner-tab"
                      aria-selected="false">Compte Partenaire</button>
            </li>
          {% endif %}
          {% if is_stripe_admin %}
            <li class="nav-item mb-2" role="presentation">
              <button class="nav-link w-100"
                      id="stripe-tab-link"
                      data-bs-toggle="pill"
                      data-bs-target="#stripe-tab"
                      type="button"
                      role="tab"
                      aria-controls="stripe-tab"
                      aria-selected="false">Compte Stripe</button>
            </li>
          {% endif %}
        </ul>
      </div>
      <!-- Tab content on the right -->
      <div class="col-md-9">
        <div class="tab-content">
          <div class="tab-pane fade show active"
               id="profile-tab"
               role="tabpanel"
               aria-labelledby="profile-tab-link">{% include "accounts/partials/profile_form.html" %}</div>
          <div class="tab-pane fade"
               id="password-tab"
               role="tabpanel"
               aria-labelledby="password-tab-link">{% include "accounts/partials/password_form.html" %}</div>
          {% if not user.is_owner and not user.is_owner_admin and not user.is_partner %}
            <div class="tab-pane fade"
                 id="reservations-tab"
                 role="tabpanel"
                 aria-labelledby="reservations-tab-link">{% include "accounts/partials/reservation_list.html" %}</div>
          {% endif %}
          {% if user.is_owner_admin or user.is_admin or user.is_superuser %}
            <div class="tab-pane fade"
                 id="admin-tab"
                 role="tabpanel"
                 aria-labelledby="admin-tab-link">
              {% include "accounts/partials/conciergerie_dashboard.html" with conciergerie=user_conciergerie %}
            </div>
          {% endif %}
          {% if user.is_partner or user.is_admin or user.is_superuser %}
            <div class="tab-pane fade"
                 id="partner-tab"
                 role="tabpanel"
                 aria-labelledby="partner-tab-link">
              {% include "accounts/partials/partner_dashboard.html" with partner=partner user_activities=user_activities %}
            </div>
          {% endif %}
          {% if is_stripe_admin %}
            <div class="tab-pane fade"
                 id="stripe-tab"
                 role="tabpanel"
                 aria-labelledby="stripe-tab-link">{% include "accounts/partials/stripe_dashboard.html" %}</div>
          {% endif %}
        </div>
      </div>
    </div>
    <div class="d-flex justify-content-center mt-5">
      <form method="post"
            action="{% url 'accounts:delete_account' %}"
            onsubmit="return confirm('Confirmez-vous la suppression de votre compte ? Cette action est irréversible.')"
            class="w-100"
            style="max-width: 320px">
        {% csrf_token %}
        <button type="submit" class="btn btn-outline-danger w-100">Supprimer mon compte</button>
      </form>
    </div>
  </div>
{% endblock %}
