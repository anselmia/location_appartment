{% extends "base.html" %}
{% load static %}
{% block extrahead %}
  {{ block.super }}
  <link rel="stylesheet"
              href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link rel="stylesheet"
        href="{% static 'administration/css/calendar.css' %}" />
{% endblock extrahead %}
{% block content %}
  <div class="container py-4">
    <div class="d-flex flex-column flex-sm-row gap-2 justify-content-sm-between align-items-start align-items-sm-center mb-4">
      <h3 class="mb-3 fw-bold">ğŸ“… Calendrier des prix</h3>
      <select id="logement-selector" class="form-select w-100 w-sm-auto ml-3">
        {% for logement in logements %}
          <option
            value="{{ logement.id }}"
            {%
            if
            forloop.first
            %}
            selected{%
            endif
            %}>{{ logement.name }}</option>
        {% endfor %}
      </select>
    </div>
    <p class="text-muted small mt-2">ğŸ“± Astuce : touchez deux dates pour sÃ©lectionner une plage.</p>
    <div class="d-flex gap-4">
      <div class="calendar-wrapper d-flex flex-wrap flex-md-nowrap position-relative">
        <div id="calendar"
             class="flex-grow-1 border rounded shadow-sm p-2 bg-white"
             style="min-width: 800px"
             data-logement-id="{{ logements.first.id }}"></div>
        <div id="price-panel"
             class="price-panel hidden border rounded shadow-sm p-3 bg-light">
          <h5 class="fw-bold mb-3">ğŸ›  Modifier le prix</h5>
          <p id="panel-dates" class="small text-muted"></p>
          <div class="mb-3">
            <label for="base-price" class="form-label">Prix de base (â‚¬)</label>
            <input type="number" id="base-price" class="form-control" />
          </div>
          <div id="details" class="price-details-container mb-3">
            <!-- Details inserted here -->
          </div>
          <div class="mb-3">
            <strong>ğŸ’° Prix Total : <span id="final-price">0</span> â‚¬</strong>
          </div>
          <div class="d-grid gap-2">
            <button id="apply-price" class="btn btn-success">âœ… Appliquer</button>
            <button id="cancel-price" class="btn btn-outline-secondary">âŒ Annuler</button>
          </div>
        </div>
      </div>
    </div>
    <div class="mt-5">
      <h5 class="fw-bold">ğŸ”— Lien Ã  partager</h5>
      <p class="text-muted small">Copiez ce lien pour partager le calendrier iCal de ce logement :</p>
      <div class="input-group">
        <input type="text"
               id="share-link"
               class="form-control"
               readonly
               value="{{ logements.first.calendar_link }}" />
        <button class="btn btn-outline-primary" onclick="copyShareLink()">Copier</button>
      </div>
    </div>
  </div>
{% endblock content %}
{% block extra_js %}
  <script>const csrfToken = "{{ csrf_token }}";</script>
  {{ logements_json|json_script:"logements-data" }}
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js'></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <script src="{% static 'administration/js/calendar.js' %}"></script>
{% endblock extra_js %}
